(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{104:function(e,t,n){},105:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"AdminPage",(function(){return D})),n.d(r,"DealerDashboard",(function(){return P})),n.d(r,"Home",(function(){return S})),n.d(r,"Login",(function(){return B}));var a,c=n(0),o=n(9),i=n.n(o),u=n(140),s=n(15),l=n(11),d=n(38),j=function(){return Object(d.b)()},b=d.c,h=n(69),p=Object(h.a)({});!function(e){e.ADMIN="admin",e.DEALER="dealer"}(a||(a={}));var O=[{roles:[],view:"Home",path:"/home",isPrivate:!1,exact:!0},{roles:[a.ADMIN],view:"AdminPage",path:"/admin/dashboard",isPrivate:!0,exact:!0},{roles:[a.DEALER],view:"DealerDashboard",path:"/dealer/dashboard",isPrivate:!0,exact:!0},{roles:[],view:"Login",path:"/login",isPrivate:!1,isAuth:!0,exact:!0}],f=n(142),x=n(28),g=n.n(x),m=n(46),v=n(27),w=n(67),A=n.n(w).a.create({withCredentials:!0}),y={autoLogin:function(){return A.get("/api/me").then((function(e){return e.data})).catch((function(e){throw e}))}},C=Object(v.b)("auth/login",function(){var e=Object(m.a)(g.a.mark((function e(t,n){var r,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.rejectWithValue,e.prev=1,e.next=4,A.post("/api/login",t,{withCredentials:!0});case 4:return a=e.sent,e.abrupt("return",a.data);case 8:if(e.prev=8,e.t0=e.catch(1),!e.t0.response){e.next=15;break}return console.log(e.t0.response),e.abrupt("return",r(e.t0.response.data.error));case 15:return e.abrupt("return",r(e.t0.message));case 16:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}()),L=Object(v.b)("auth/logout",function(){var e=Object(m.a)(g.a.mark((function e(t,n){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.rejectWithValue,console.log("pressed logout"),e.prev=2,e.next=5,A.get("/api/logout");case 5:e.next=15;break;case 7:if(e.prev=7,e.t0=e.catch(2),!e.t0.response){e.next=14;break}return console.log(e.t0.response),e.abrupt("return",r(e.t0.response));case 14:return e.abrupt("return",r(e.t0.message));case 15:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t,n){return e.apply(this,arguments)}}()),R=Object(v.b)("auth/autoLogin",Object(m.a)(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.autoLogin();case 3:return t=e.sent,e.abrupt("return",t);case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))),E=Object(v.c)({name:"auth",initialState:{loading:!1,error:null,role:null,isAuthenticated:!1,username:""},reducers:{},extraReducers:function(e){e.addCase(C.pending,(function(e,t){e.loading=!0})),e.addCase(C.fulfilled,(function(e,t){localStorage.setItem("USER_ROLE",t.payload.role),e.role=t.payload.role,e.loading=!1,e.isAuthenticated=!0})),e.addCase(C.rejected,(function(e,t){e.error=String(t.payload),e.loading=!1,e.isAuthenticated=!1})),e.addCase(L.fulfilled,(function(e,t){console.log("logout fullfilled"),localStorage.removeItem("USER_ROLE"),e.role=null,e.isAuthenticated=!1})),e.addCase(L.rejected,(function(e,t){e.error=String(t.payload),e.isAuthenticated=!0})),e.addCase(R.pending,(function(e){e.loading=!0})),e.addCase(R.fulfilled,(function(e,t){e.loading=!1,e.isAuthenticated=t.payload.isAuthenticated,e.role=t.payload.role,e.username=t.payload.username})),e.addCase(R.rejected,(function(e){e.isAuthenticated=!1}))}}).reducer,k=n(3),D=function(){var e=j(),t=Object(l.g)();return Object(k.jsxs)("div",{children:[Object(k.jsx)(f.a,{onClick:function(){e(L()).then((function(){return t.push("/login")}))},children:"logout"}),Object(k.jsx)(f.a,{onClick:function(){A.get("/api/me").then((function(e){return console.log(e)}))},children:"Me"}),Object(k.jsx)("h1",{style:{textAlign:"center"},children:"Admin page"})]})},P=function(){return Object(k.jsx)("h1",{children:"Dealer dashboard"})},S=function(){return Object(k.jsxs)("div",{children:[Object(k.jsxs)("ul",{children:[Object(k.jsx)("li",{children:Object(k.jsx)(s.b,{to:"/admin/dashboard/",children:"admin page"})}),Object(k.jsx)("li",{children:Object(k.jsx)(s.b,{to:"/login",children:"Login"})})]}),Object(k.jsx)("h1",{children:"HomePage"})]})},I=n(138),W=n(137),H=n(143),N=n(52),U=n(139),M=n(141),q=Object(W.a)((function(e){return Object(H.a)({root:{},btn:{marginTop:e.spacing(1)}})})),J=function(){var e=Object(c.useState)(""),t=Object(N.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)(""),o=Object(N.a)(a,2),i=o[0],u=o[1],l=q(),d=j(),h=b((function(e){return e.authReducer})).error;return Object(k.jsxs)(I.a,{className:l.root,children:[h,Object(k.jsx)(U.a,{variant:"h5",align:"center",children:"Login"}),Object(k.jsxs)("form",{onSubmit:function(e){e.preventDefault(),d(C({username:n,password:i}))},children:[Object(k.jsx)(M.a,{fullWidth:!0,variant:"outlined",placeholder:"Username",label:"Username",autoFocus:!0,type:"text",margin:"normal",required:!0,value:n,onChange:function(e){return r(e.target.value)}}),Object(k.jsx)(M.a,{fullWidth:!0,required:!0,variant:"outlined",placeholder:"Password",label:"Password",type:"password",margin:"normal",value:i,onChange:function(e){return u(e.target.value)}}),Object(k.jsx)(f.a,{variant:"contained",color:"primary",type:"submit",className:l.btn,fullWidth:!0,children:"Login"})]}),Object(k.jsx)(f.a,{children:Object(k.jsx)(s.b,{to:"/home",children:"Home"})})]})},V=Object(W.a)((function(){return Object(H.a)({root:{height:"100vh",display:"flex",alignItems:"center"}})})),_=function(){var e=V();return Object(k.jsx)(I.a,{component:"main",maxWidth:"xs",className:e.root,children:Object(k.jsx)(J,{})})},B=function(){return Object(k.jsx)(_,{})},F=n(22),T=n(30),z=function(e){var t=e.component,n=Object(T.a)(e,["component"]),r=b((function(e){return e.authReducer})).isAuthenticated;return Object(k.jsx)(l.b,Object(F.a)(Object(F.a)({},n),{},{children:r?Object(k.jsx)(t,{}):Object(k.jsx)(l.a,{to:"/login"})}))},G=function(e){var t=e.component,n=Object(T.a)(e,["component"]),r=b((function(e){return e.authReducer})),a=r.isAuthenticated,c=r.role;return Object(k.jsx)(l.b,Object(F.a)(Object(F.a)({},n),{},{children:a?Object(k.jsx)(l.a,{to:"/".concat(c,"/dashboard")}):Object(k.jsx)(t,{})}))},K=function(e){var t=e.component,n=Object(T.a)(e,["component"]);return Object(k.jsx)(l.b,Object(F.a)(Object(F.a)({},n),{},{children:Object(k.jsx)(t,{})}))},Q=(n(104),function(){return Object(k.jsxs)("div",{children:[Object(k.jsxs)("ul",{children:[Object(k.jsx)("li",{children:Object(k.jsx)(s.b,{to:"/home",children:"Home"})}),Object(k.jsx)("li",{children:Object(k.jsx)(s.b,{to:"/login",children:"Login"})})]}),Object(k.jsx)("h1",{style:{color:"red"},children:"Error page"})]})});var X=function(){var e=b((function(e){return e.authReducer})),t=e.role,n=e.loading,a=j();return Object(c.useEffect)((function(){a(R())}),[a]),n?Object(k.jsx)("h1",{children:"...loading"}):Object(k.jsx)(u.a,{theme:p,children:Object(k.jsx)(s.a,{children:Object(k.jsxs)(l.d,{children:[Object(k.jsx)(l.b,{path:"/",exact:!0,children:Object(k.jsx)(l.a,{to:"/home"})}),function(){var e=O.filter((function(e){var n=e.roles;return!!(n&&0===n.length||t&&n.includes(t))}));return console.log(e),e.map((function(e){var t=e.path,n=e.view,a=e.isPrivate,c=e.exact,o=e.isAuth,i=r[n];return a?Object(k.jsx)(z,{path:t,component:i,exact:c},t):o?Object(k.jsx)(G,{path:t,component:i,exact:c},t):Object(k.jsx)(K,{path:t,component:i,exact:c},t)}))}(),Object(k.jsx)(l.b,{children:Object(k.jsx)(Q,{})})]})})})},Y={authReducer:E},Z=Object(v.a)({reducer:Y});i.a.render(Object(k.jsx)(d.a,{store:Z,children:Object(k.jsx)(X,{})}),document.getElementById("root"))}},[[105,1,2]]]);
//# sourceMappingURL=main.24097b5c.chunk.js.map